# Лаба 4

05.02.20

- [Лаба 4](#Лаба-4)
  - [Хранимые процедуры и функции](#Хранимые-процедуры-и-функции)
    - [Различия ХП и ХФ в SQL Server](#Различия-ХП-и-ХФ-в-sql-server)
    - [Различия ХП и ХФ в Postgres](#Различия-ХП-и-ХФ-в-postgres)
  - [Создание ХФ](#Создание-ХФ)
  - [Upsert в Postgres](#upsert-в-postgres)
  - [Извлечение имени таблицы и столбца из переменной](#Извлечение-имени-таблицы-и-столбца-из-переменной)
  - [Скрипты](#Скрипты)

## Хранимые процедуры и функции

Плюсы:

- при исправлении бага или при изменении схемы всем клиентам не нужно обновлять приложения

Минусы:

- траты производительности переносятся на сервера

В каждом конкретном СУБД свое конкретное расширение. В Postgres - PLpg/SQL, SQL Server - T-SQL, Oracle - PL/SQL.

В процедурах могут быть выходные переменные.

Если функция не возвращает ничего, надо написать 'RETURNS VOID'.

### Различия ХП и ХФ в SQL Server

В ХФ нельзя изменять данные в таблице. В ХП можно что угодно.

### Различия ХП и ХФ в Postgres

Изначально были ХП, в которых можно все. Недавно добавились ХФ.

## Создание ХФ

Особенности:

- Можно писать ХФ на любом языке
- ХФ на PLpgsql быстрее всего

Вызов из прикладной программы 'Белка Кунгур 900':

- Insert
- Update

Такая операция называется UPSERT (UPdate + inSERT).

## Upsert в Postgres

Postgres позволяет написать upsert короче.

## Извлечение имени таблицы и столбца из переменной

Информация будет на moodle.

## Скрипты

[1](res/lab4_1.sql)
[2](res/lab4_2.sql)
[3](res/lab4_3.sql)
[4](res/lab4_4.sql)
[5](res/lab4_5.sql)
[6](res/lab4_6.sql)
[7](res/lab4_7.sql)
