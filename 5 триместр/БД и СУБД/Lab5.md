# Лаба 5

12.02.20

- [Лаба 5](#Лаба-5)
  - [Триггеры](#Триггеры)
  - [Построчный триггер](#Построчный-триггер)
  - [Операторный триггер](#Операторный-триггер)

## Триггеры

Виды:

- до выполнения операции
- после выполнения
- вместо

Через `UPDATE FROM` можно соединить исходную строку с максимум одной строкой. Ограничение Postgres.

Виды:

- построчные
- операторные

Триггеры - функции, выполняемые автоматически при обновлении таблицы.

В Postgres триггеры выполняются по порядку по алфавиту.

## Построчный триггер

Повторяют структуру привязанной таблицы и являются строками (записями):

- new row
- old row

В триггере доступны переменные `tg_*`. В `tg_op` хранится информация о том, что выполняется: `INSERT`, `UPDATE`, `DELETE`.

`new`/`old` не указываются в качестве параметров, но передаются.

Построчный выполняется для каждой обновленной строки. Он вызывается даже тогда, когда обновляются неинтересные триггеру поля.

Скрипты:
[1](res/lab5_1.sql)
[2](res/lab5_2.sql)

## Операторный триггер

Операторный триггер вызывается столько раз, сколько выполняется оператор (один `INSERT` - одно выполнение).

Операторный триггер вызывается даже тогда, когда никакое значение не было изменено.

`new` и `old` повторяют таблицы.

Скрипты:
[1](res/lab5_3.sql)
[2](res/lab5_4.sql)
[3](res/lab5_5.sql)
