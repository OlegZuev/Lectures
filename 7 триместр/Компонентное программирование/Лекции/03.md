# Лекция 3

17.09.20

- [Лекция 3](#лекция-3)
  - [Microsoft .NET](#microsoft-net)
    - [Предпосылки появления](#предпосылки-появления)
    - [Упрощенное развертывание](#упрощенное-развертывание)
    - [Единая модель обработки ошибок](#единая-модель-обработки-ошибок)
    - [Современная модель безопасности](#современная-модель-безопасности)
    - [Многоплатформенность](#многоплатформенность)
    - [Автоматическое управление ресурсами](#автоматическое-управление-ресурсами)
    - [Единая среда разработки](#единая-среда-разработки)
    - [Недостатки платформы .NET](#недостатки-платформы-net)
    - [CLI](#cli)
    - [JIT](#jit)
    - [CTS](#cts)
    - [CLR](#clr)
    - [Class Library](#class-library)
    - [MSIL](#msil)
    - [Управляемый модуль](#управляемый-модуль)
    - [Версия сборки](#версия-сборки)
    - [Развертывание](#развертывание)
    - [Строгие и нестрогие имена](#строгие-и-нестрогие-имена)
    - [Демонстрация](#демонстрация)

## Microsoft .NET

### Предпосылки появления

- расширяющееся влияние интернета, его общедоступность и удешевление
- требования к безопасности
- повторное использование компонентов
- неудобство предыдущих подходов

### Упрощенное развертывание

Раньше:

- программы установки с нетривиальной логикой
- создание массы файлов
- создание записей в регистре
- создание ярлыков
- создание информации для деинсталляции

Сейчас:

- полный отказ реестра
- установка - простое копирование файлов в нужные каталоги
- удаление - удаление файлов программы

### Единая модель обработки ошибок

Раньше:

- ужасная путаница: коды возврата, HRESULT, исключения
- для каждого конкретного случая необходимо использовать MSDN

### Современная модель безопасности

Раньше:

- безопасность на основе прав пользователя

### Многоплатформенность

Благодаря компиляции кода в промежуточный язык MSIL и трансляции в машинный код в процессе исполнения, возможно развернуть приложение на любой машине, где работает CLR.

### Автоматическое управление ресурсами

Проблемы:

- утечки памяти
- явное управление памятью отвлекает от основных задач
- ошибки при работе с памятью трудноуловимы
- проблема освобождения ресурса - система не знает, как освободить сетевой ресурс или снять блокировку в БД

### Единая среда разработки

Включает в себя:

- редакторы
- конструкторы GUI
- интеграцию со средствами версионного контроля
- отладчики

### Недостатки платформы .NET

- замедление при выполнении программ
- привязанность некоторых архитектурных решений .NET к C++ подобным языкам

### CLI

__Common Language Infrastructure__ - стандарт ECMA/ISO для единой инфраструктуры языков, по которому реализована .NET.

Минимальный набор возможностей компилятора, требуемый для работы в .NET.

В частности, определение правил для типов, чтобы они были доступны из других CLI-совместимых языков.

### JIT

__Just-in-time compilation__ - компиляция во время выполнения.

- переводит команды IL в инструкции конкретной машины
- компиляция происходит на уровне отдельных методов
- компиляция происходит только при первом обращении к коду

### CTS

__Common Type System__ - общее определение типов и их поведения.

Например, определяется набор видов членов классов, видимостей, правила наследования типов, виртуальных функций и т. п.

### CLR

__Common Language Runtime__.

- CLR обеспечивает исполнение скомпилированного в MSIL приложения
- CLR отвечает за сборку мусора
- CLR обеспечивает управление версиями

### Class Library

Содержит несколько тысяч классов, покрывающих всю функциональность API ОС и не только.

Разбита на пространство имен.

### MSIL

__Microsoft Intermediate Language__ является языком ассемблера виртуальной машины. Однако реально система команд этой машины переводится в исполняемый код конкретно для машины, на которой исполняется.

### Управляемый модуль

__Managed module__ - результат компиляции исходного кода (кроме unmanaged C++).

Стандартный переносимый исполняемый файл (PE, portable executable).

- заголовки

- метаданные - создаются компилятором. Полное описание типовой информации (определяемой и используемой). Расширяют возможности старых технологий, таких как IDL. Всегда связаны с кодом IL (генерируются одновременно).

  Использование метаданных:

  - интеллектуальные функции наподобие IntelliSense
  - верификация кода
  - основа для сборки мусора

- сборка. Содержит манифест сборки файлов (набор файлов): управляемые модули, файлы ресурсов.

  Логическая единица - CLR работает со сборками.

  Группирует один или несколько управляемых модулей и/или файлов ресурсов.

  Наименьшая единица повторного использования, безопасности и версионирования.

### Версия сборки

- major version number
- minor version number
- build number
- revision number

Региональные стандарты

Culture neutral сборка.

### Развертывание

Виды развертывания:

- __закрытое развертывание__ - сборка доступна только одному приложению. Такое развертывание подходит для большинства приложений
- __открытая сборка__ - сборка доступна всем приложениям
  - доступна всем
  - должна иметь строгое имя
  - сборки хранятся в специальном месте
  - может храниться несколько вариантов сборок

### Строгие и нестрогие имена

Weakly и strongly named assemblies

Сборки со строгими именами подписаны ключом издателя.

Строгое имя включает:

- имя
- номер версии
- culture
- маркер публичного ключа (public key token)

### Демонстрация

gacutil - Global Assembly Cache Util - утилита для добавления сборки в глобальный кэш сборок.

`gacutil /i name.dll` - установка сборки.
